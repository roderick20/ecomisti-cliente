<!-- templates/facturas/listar.html -->
{% extends "base.html" %}

{% block title %}Facturas{% endblock %}

{% block extra_css %}
<style>
    .dataTables_wrapper .dataTables_length select {
        width: auto;
    }
    .table-responsive {
        border: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-file-invoice"></i> Gestión de Facturas</h2>
        <p class="text-muted">Administra todas las facturas del sistema</p>
    </div>
    <a href="{{ url_for('facturas.nueva') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Nueva Factura
    </a>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table id="facturas-table" class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Número</th>
                        <th>Cliente</th>
                        <th>Fecha</th>
                        <th>Total</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Datos cargados vía AJAX -->
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    var table = $('#facturas-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: "{{ url_for('facturas.api_data') }}",
            type: 'GET'
        },
        columns: [
            { data: 0, searchable: true },  // Número
            { data: 1, searchable: true },  // Cliente
            { data: 2, searchable: false }, // Fecha
            { data: 3, searchable: false }, // Total
            { data: 4, searchable: true },  // Estado
            { data: 5, searchable: false, orderable: false } // Acciones
        ],
        order: [[2, 'desc']], // Ordenar por fecha descendente
        language: {
            url: 'https://cdn.datatables.net/plug-ins/1.11.5/i18n/es-ES.json'
        },
        pageLength: 25,
        responsive: true,
        dom: 'Bfrtip',
        buttons: [
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                className: 'btn btn-success btn-sm me-2'
            },
            {
                text: '<i class="fas fa-chart-bar"></i> Reportes',
                className: 'btn btn-info btn-sm',
                action: function() {
                    window.location.href = "{{ url_for('reportes.ventas') }}";
                }
            }
        ]
    });
});

function generarPDF(facturaId) {
    window.open("{{ url_for('facturas.generar_pdf', id=0) }}".replace('0', facturaId), '_blank');
}
</script>
{% endblock %}

